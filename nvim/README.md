# Neovim Configuration Documentation

このドキュメントは、`~/.config/nvim`に設定されたNeovimの包括的な機能解説です。

## 目次

- [概要](#概要)
- [ディレクトリ構造](#ディレクトリ構造)
- [プラグイン一覧](#プラグイン一覧)
- [キーマッピング](#キーマッピング)
- [カスタムコマンド](#カスタムコマンド)
- [LSPとフォーマッター](#lspとフォーマッター)
- [UI/UXカスタマイズ](#uiuxカスタマイズ)
- [自動コマンドと機能](#自動コマンドと機能)

## 概要

この設定は、LazyVimフレームワークをベースに、多言語開発環境を構築しています。プロジェクトタイプを自動検出し、必要なツールを動的にインストールする仕組みを持っています。

### 主な特徴
- **プラグインマネージャー**: lazy.nvim
- **ベースフレームワーク**: LazyVim
- **カラースキーム**: GitHub Dark（透過背景）
- **リーダーキー**: スペースキー

## ディレクトリ構造

```
~/.config/nvim/
├── init.lua                    # エントリーポイント
├── lazy-lock.json             # プラグインのバージョンロック
├── lua/
│   ├── config/
│   │   ├── autocmds.lua      # 自動コマンド
│   │   ├── keymaps.lua       # グローバルキーマッピング
│   │   ├── lazy.lua          # lazy.nvimの設定
│   │   └── options.lua       # Neovimオプション
│   └── plugins/
│       ├── code-actions.lua   # コードアクション
│       ├── colorscheme.lua    # カラースキーム
│       ├── completion.lua     # 補完設定
│       ├── database.lua       # データベース機能
│       ├── debug.lua          # デバッグ設定
│       ├── editor.lua         # エディター拡張
│       ├── error-fixes.lua    # エラー修正
│       ├── git.lua            # Git統合
│       ├── intellij-ui.lua    # IntelliJ風UI
│       ├── linting.lua        # リンター設定
│       ├── lsp.lua            # LSP設定
│       ├── project-management.lua # プロジェクト管理
│       ├── refactoring.lua    # リファクタリング
│       ├── treesitter.lua     # Treesitter設定
│       └── ui.lua             # UI設定
└── README.md                  # このファイル
```

## プラグイン一覧

### コアフレームワーク
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **lazy.nvim** | プラグインマネージャー | 遅延読み込み、依存関係管理 |
| **LazyVim** | ベース設定フレームワーク | 事前設定済みの開発環境 |

### UI・外観
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **github-nvim-theme** | カラーテーマ | GitHub Dark、透過背景対応 |
| **noice.nvim** | UI拡張 | コマンドライン、通知、メッセージのUI改善 |
| **nvim-notify** | 通知システム | カスタマイズ可能な通知（7秒表示） |
| **bufferline.nvim** | バッファタブ | タブ形式のバッファ表示 |
| **lualine.nvim** | ステータスライン | カスタマイズされた情報表示 |
| **nvim-web-devicons** | ファイルアイコン | ファイルタイプごとのアイコン表示 |

### エディター・ナビゲーション
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **telescope.nvim** | ファジーファインダー | ファイル検索、grep、バッファ切替 |
| **neo-tree.nvim** | ファイルエクスプローラー | サイドバー形式のファイルツリー |
| **project.nvim** | プロジェクト管理 | 自動プロジェクト検出、切替 |
| **close-buffers.nvim** | バッファ管理 | 複数バッファの一括操作 |

### 補完・スニペット
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **blink.cmp** | 補完エンジン | 高速な補完機能 |
| **LuaSnip** | スニペットエンジン | コードスニペット展開 |
| **cmp-nvim-lsp** | LSP補完 | LSPからの補完候補 |
| **cmp-buffer** | バッファ補完 | 開いているバッファからの補完 |
| **cmp-path** | パス補完 | ファイルパスの補完 |
| **cmp-cmdline** | コマンドライン補完 | `:` コマンドの補完 |

### Git統合
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **gitsigns.nvim** | Git装飾 | 変更行の表示、ハンク操作 |
| **git.nvim** | Git操作 | blame、リポジトリ内で開く |

### LSP・言語サポート
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **nvim-lspconfig** | LSP設定 | 言語サーバーの設定 |
| **mason.nvim** | ツール管理 | LSP、フォーマッター、リンターの自動インストール |
| **neoconf.nvim** | プロジェクト設定 | プロジェクトごとのLSP設定 |
| **trouble.nvim** | 診断UI | エラー・警告の一覧表示 |
| **actions-preview.nvim** | コードアクション | プレビュー付きコードアクション |

### Treesitter
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **nvim-treesitter** | 構文解析 | 高度なシンタックスハイライト |
| **playground** | Treesitter分析 | 構文木の可視化 |
| **nvim-treesitter-refactor** | リファクタリング | Treesitterベースのリファクタリング |

### フォーマット・リンティング
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **conform.nvim** | コードフォーマッター | 多言語対応のフォーマット |
| **dial.nvim** | インクリメント拡張 | 数値、日付、定数の増減 |

### リファクタリング
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **refactoring.nvim** | リファクタリング操作 | 関数抽出、変数抽出など |
| **inc-rename.nvim** | インクリメンタル改名 | リアルタイムプレビュー付き改名 |

### データベース
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **vim-dadbod** | DB接続 | 多数のDBサポート |
| **vim-dadbod-ui** | DB UI | データベースエクスプローラー |
| **nvim-dbee** | モダンDB UI | より新しいデータベースクライアント |

### デバッグ
| プラグイン | 説明 | 主な機能 |
|-----------|------|----------|
| **nvim-dap** | デバッグプロトコル | 多言語デバッグサポート |
| **nvim-dap-ui** | デバッグUI | 変数、スタック、ブレークポイント表示 |

## キーマッピング

### 基本操作
| キー | モード | 説明 |
|-----|--------|------|
| `<Space>` | Normal | リーダーキー |
| `jj` | Insert | ESCの代替（ノーマルモードへ） |
| `<C-l>` | Insert | 右に移動してインサートモード |
| `<C-h>` | Insert | 左に移動してインサートモード |

### ナビゲーション
| キー | モード | 説明 |
|-----|--------|------|
| `<Space>h` | Normal | 行頭へジャンプ |
| `<Space>l` | Normal | 行末へジャンプ |
| `<C-n>` | Normal | 半ページ下へスクロール |
| `<C-h/j/k/l>` | Normal | ウィンドウ間の移動 |

### ファイル操作
| キー | モード | 説明 |
|-----|--------|------|
| `<leader>f` | Normal | ファイル検索（Telescope） |
| `<leader>r` | Normal | テキスト検索（Live grep） |
| `nt` | Normal | ファイルツリーをトグル |
| `<leader>e` | Normal | ファイルツリーをトグル/現在ファイルを表示 |
| `<leader>o` | Normal | ファイルツリーにフォーカス |
| `sf` | Normal | ファイルブラウザ |

### バッファ操作
| キー | モード | 説明 |
|-----|--------|------|
| `tn` | Normal | 次のバッファへ |
| `tp` | Normal | 前のバッファへ |
| `\\` | Normal | バッファ一覧（Telescope） |
| `<leader>th` | Normal | 隠れたバッファを閉じる |
| `<leader>tu` | Normal | 名前のないバッファを閉じる |

### LSP操作
| キー | モード | 説明 |
|-----|--------|------|
| `gh` | Normal | ホバー情報表示 |
| `gr` | Normal | 参照検索 |
| `gd` | Normal | 定義へジャンプ（Telescope） |
| `gn` | Normal | シンボル名変更 |
| `go` | Normal | コードアクション |
| `[e` / `]e` | Normal | エラー間を移動 |
| `[w` / `]w` | Normal | 警告間を移動 |
| `[d` / `]d` | Normal | 診断間を移動 |
| `<leader>rn` | Normal | 名前変更 |
| `<leader>ca` | Normal | コードアクション |
| `<leader>f` | Normal | コードフォーマット |

### Git操作
| キー | モード | 説明 |
|-----|--------|------|
| `<Leader>blame` | Normal | Git blame表示 |
| `<Leader>go` | Normal | Gitリポジトリで開く |
| `]c` / `[c` | Normal | Gitハンク間を移動 |
| `<leader>hs` | Normal | ハンクをステージ |
| `<leader>hr` | Normal | ハンクをリセット |
| `<leader>hS` | Normal | バッファ全体をステージ |
| `<leader>hp` | Normal | ハンクをプレビュー |
| `<leader>hb` | Normal | 行のblame情報 |

### リファクタリング
| キー | モード | 説明 |
|-----|--------|------|
| `<leader>re` | Visual/Normal | 関数を抽出 |
| `<leader>rf` | Visual/Normal | ファイルへ抽出 |
| `<leader>rv` | Visual/Normal | 変数を抽出 |
| `<leader>ri` | Visual | 変数をインライン化 |
| `<leader>rI` | Normal | 関数をインライン化 |
| `<S-F6>` | Normal | IntelliJ風の名前変更 |
| `<C-A-m>` | Visual | メソッド抽出 |
| `<C-A-v>` | Visual | 変数抽出 |
| `grr` | Normal | スマート名前変更 |

### データベース
| キー | モード | 説明 |
|-----|--------|------|
| `<leader>du` | Normal | データベースUIをトグル |
| `<leader>dr` | Normal | クエリ実行/バッファ名変更 |
| `<leader>db` | Normal | Dbeeをトグル |
| `<F5>` | Normal | SQLクエリ実行 |

### デバッグ
| キー | モード | 説明 |
|-----|--------|------|
| `<F5>` | Normal | デバッグ継続 |
| `<F6>` | Normal | ステップオーバー |
| `<F7>` | Normal | ステップイン |
| `<F8>` | Normal | ステップアウト |
| `<F9>` | Normal | ブレークポイントをトグル |

### その他
| キー | モード | 説明 |
|-----|--------|------|
| `*` | Normal | カーソル位置を保持して検索 |
| `<C-[>` | Normal | 折りたたみをトグル |
| `<Esc>` | Terminal | ターミナルモードを終了 |
| `p` | Visual | ヤンクせずにペースト |
| `<C-a>` | Normal | 数値を増加 |
| `<C-x>` | Normal | 数値を減少 |

## カスタムコマンド

### フォーマット
| コマンド | 説明 |
|---------|------|
| `:Fm` または `:fm` | 現在のファイルをフォーマット |

### LSP管理
| コマンド | 説明 |
|---------|------|
| `:LspRestart <server_name>` | 特定のLSPサーバーを再起動 |

### バッファ管理
| コマンド | 説明 |
|---------|------|
| `:CloseAllBuffer` | 現在のバッファ以外を全て閉じる |

### Neo-tree
| コマンド | 説明 |
|---------|------|
| `:Neotree` | ファイルツリーを開く |
| `:Neotree toggle` | ファイルツリーをトグル |
| `:Neotree reveal` | 現在のファイルを表示 |

## LSPとフォーマッター

### 常時インストールされるLSP
- **lua-language-server**: Lua
- **json-lsp**: JSON
- **yaml-language-server**: YAML

### プロジェクトタイプに応じて自動インストールされるLSP

#### JavaScript/TypeScript
- **typescript-language-server**: TypeScript/JavaScript
- **eslint**: リンティング
- **prettier**: フォーマッター

#### Python
- **pyright**: 型チェック、補完
- **black**: フォーマッター
- **isort**: import文の整理

#### Go
- **gopls**: Go言語サーバー
- **gofumpt**: フォーマッター
- **goimports**: import文の整理

#### その他の言語
- **rust-analyzer**: Rust
- **clangd**: C/C++
- **jdtls**: Java
- **solargraph**: Ruby
- **intelephense**: PHP
- **dockerls**: Docker
- **tailwindcss-language-server**: Tailwind CSS
- **cssls**: CSS
- **html**: HTML
- **prismals**: Prisma

## UI/UXカスタマイズ

### テーマ設定
- **カラースキーム**: GitHub Dark
- **背景**: 透過（transparent）
- **アイコン**: Nerd Fonts使用

### レイアウト
- **ファイルツリー**: 左側、幅30文字
- **シンボルアウトライン**: 右側、幅25文字
- **分割**: デフォルトで下と右に開く
- **コマンドライン高さ**: 0（使用時のみ表示）

### 視覚的要素
- **Git装飾**: +（追加）、~（変更）、_（削除）
- **診断表示**: エラー/警告のインライン表示
- **バッファライン**: 開いているバッファをタブ形式で表示
- **ステータスライン**: ファイルパス、Git情報、診断情報を表示

### 通知設定
- **表示時間**: 7秒
- **位置**: 右上
- **アニメーション**: フェードイン/アウト

## 自動コマンドと機能

### 自動実行される機能
1. **ペーストモード自動解除**: Insert modeを抜ける際に自動でペーストモードを解除
2. **Conceal無効化**: JSON、Markdown ファイルでconcealを無効化
3. **スペルチェック無効化**: Markdownファイルでスペルチェックを無効化
4. **プロジェクトタイプ検出**: ディレクトリ変更時に自動でプロジェクトタイプを検出
5. **ツール自動インストール**: 検出されたプロジェクトタイプに応じて必要なツールを自動インストール

### データベース関連
- **接続成功/失敗通知**: データベース接続時に通知を表示
- **出力フォーマット**: データベース出力を見やすく整形
- **SQL大文字化**: SQLキーワードを自動で大文字に変換

### セッション管理
- **自動セッション保存**: プロジェクトごとにセッションを自動保存
- **セッション復元**: プロジェクトを開く際に前回のセッションを復元

## トラブルシューティング

### よくある問題と解決方法

#### Neo-treeが動作しない
1. `:Lazy`でプラグインの状態を確認
2. `:checkhealth neo-tree`で診断を実行
3. `error-fixes.lua`で無効化されていないか確認

#### LSPが動作しない
1. `:LspInfo`で現在のLSP状態を確認
2. `:Mason`でLSPサーバーがインストールされているか確認
3. `:LspRestart <server_name>`でLSPサーバーを再起動

#### フォーマットが効かない
1. `:ConformInfo`でフォーマッターの状態を確認
2. `:Fm`コマンドで手動フォーマットを試す
3. プロジェクトルートに設定ファイル（.prettierrc等）があるか確認

## カスタマイズのヒント

### 新しいプラグインを追加する場合
1. `lua/plugins/`ディレクトリに新しい`.lua`ファイルを作成
2. lazy.nvimの仕様に従ってプラグインを定義
3. `:Lazy`でインストール

### キーマッピングを追加する場合
- グローバル: `lua/config/keymaps.lua`に追加
- プラグイン固有: 各プラグイン設定ファイルの`keys`テーブルに追加

### LSPサーバーを追加する場合
1. `lua/plugins/lsp.lua`の該当する言語セクションに追加
2. Masonでインストール可能か確認
3. 必要に応じて設定を追加

---

このドキュメントは設定の主要な機能を網羅していますが、各プラグインの詳細な機能については、それぞれの公式ドキュメントを参照してください。
